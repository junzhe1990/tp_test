{include file='/public/X_admin/x_admin_head'}
<div class="layui-fluid">
    <!--    展示核查项目及内容-->
    <div class="layui-row">
        <table class="layui-table" lay-size="lg">
            <thead>
            <tr>
                <td>项目名称</td>
                <td>核查周期</td>
                <td>责任人</td>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>{$tab.item}</td>
                <td>{$tab.cycle}</td>
                <td>{$tab.liable}</td>
            </tr>
            <tr>
                <td colspan="3">{$tab.content|raw}</td>
            </tr>
            </tbody>
        </table>
    </div>
    <hr class="layui-bg-green">
    <!--    添加核查记录-->
    <div class="layui-row">
        <form class="layui-form layui-form-pane" action="" method="post">
            <input type="hidden" name="track_id" value="{$tab.id}">
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">核查结果</label>
                <div class="layui-input-block">
                    <textarea name="content" placeholder="请输入核查结果" class="layui-textarea" required
                              lay-verify="required" id="content"></textarea>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">核查时间</label>
                <div class="layui-input-block">
                    <input type="text" name="check_time" placeholder="请选择核查时间" autocomplete="off"
                           class="layui-input" id="check_time" required lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">是否正常</label>
                <div class="layui-input-block">
                    <select name="isok" lay-search="" required lay-verify="required">
                        <option value="1" selected>正常</option>
                        <option value="2">异常</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">核查人员</label>
                <div class="layui-input-block">
                    <select name="user_name" required lay-verify="required">
                        <option value="">请选择核查人</option>
                        {volist name='user_name' id='nn'}
                        <option value="{$nn.name}" {if $tab.liable == $nn.name}selected{/if}>{$nn.name}</option>
                        {/volist}
                    </select>
                </div>
            </div>
            <!--                        提交-->
            <div class="layui-form-item">
                <button class="layui-btn layui-btn-fluid layui-btn-radius" lay-submit lay-filter="recordAdd">
                    <i class="iconfont">&#xe6b9;</i>提交核查记录
                </button>
            </div>
        </form>
    </div>
</div>
<script>
    //Demo
    layui.use(['form', 'layer', 'laydate'], function () {
        $ = layui.jquery;
        var form = layui.form,
            laydate = layui.laydate,
            layer = layui.layer;
        laydate.render({
            elem: '#check_time',
            type: 'datetime'
        });
        form.on('submit(recordAdd)', function () {
            $.ajax({
                type: 'POST',
                url: '{$urlAdd}',
                data: $('form').serialize(),
                success: function (code) {
                    if (code === 1) {
                        layer.alert("添加失败");
                    } else {
                        layer.alert("添加成功", {
                                icon: 6
                            },
                            function () {
                                //关闭当前frame
                                xadmin.close();
                                // 可以对父窗口进行刷新
                                xadmin.father_reload();
                            });
                    }
                },
                error: function () {
                    layer.alert('Ajax请求失败！请联系管理员检查');
                },
                dataType: 'json'
            });
            return false;
        });
    });
</script>
{include file='/public/X_admin/x_admin_foot'}
